{% extends 'base.html' %}

{% block myplaces-act%}class=active{%endblock%}

{% block extra_head %}
<style type="text/css">
  #map_canvas {
    height: 500px;
  }
</style>

<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
<script type="text/javascript">
var map;

var neighborhoods = [
                     {% for place in myplaces %}
                     ['{{place.city}},{{place.country}}',
                      '{{place.date}}','{{place.latlong}}'],
                     {% endfor %}
                     ];

$(document).ready(function initialize() {
    var myLatlng = new google.maps.LatLng(50.736455, 13.007813);

    var myOptions = {
      zoom: 4,
      center: myLatlng,
      mapTypeId: google.maps.MapTypeId.ROADMAP
    }

    map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
    
    for ( var i = 0; i < neighborhoods.length; i++){
        codeAddress(neighborhoods[i],false);
    }
 })

function findCity(city,year,latlong){
  var a = new Array(city,year,latlong);
  codeAddress(a,true);
}

function codeAddress(address,setCenter) {
    var coordinates = address[2].split(',')
    var latLng = new google.maps.LatLng(coordinates[0],coordinates[1]);
          
    if(setCenter){
            map.setCenter(latLng);
            map.setZoom(6);
    }
    var infowindow = new google.maps.InfoWindow({
    content: address[0] + ' in ' + address[1]
    });
    
    var image = '{{STATIC_URL}}img/hackergotchi-little.png';
    
      var marker = new google.maps.Marker({
          map: map, 
          position: latLng,
          title: address[0],
          icon: image
      });
      
      if(setCenter){
        infowindow.open(map,marker);
      }
      
        google.maps.event.addListener(marker, 'click', function() {
          infowindow.open(map,marker);
        }); 
}
</script>

{% endblock %}

{% block content %}
<div class="container">
    <div class="span7">
        <div id="map_canvas"></div>
    </div>
    <div class="span4" style="overflow: scroll; height: 500px">
        {% if myplaces %}
        <table class="table">
            {% for place in dict %}
                <tr>
                    <td>
                    <img src="{{ place.flag }}" height="20" width="31">
                    </td>
                    <td>
                    {{ place.country }} 
                    </td>
                    <td>
                    {{ place.date }} 
                    </td>
                    <td>
                    {% if place.cities %}
                        {% for city in place.cities %}
                            <a onclick="findCity('{{city.name}},{{place.country}}','{{city.date}}','{{city.latlong}}')">{{city.name}}</a>
                        {% endfor %}
                    {% else %}
                        No cities
                    {% endif %}
                    </td>
                </tr>
            {% endfor %}
        </table>
        {% endif %}
    </div>
</div>
{% endblock %}