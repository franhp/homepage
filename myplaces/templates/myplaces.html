{% extends 'base.html' %}
{% load staticfiles %}


{% block extra_bottom %}
<script src="https://maps.googleapis.com/maps/api/js?key={{ maps_key }}"></script>
<script>
$(function () {

    function initMap() {
        var mapCanvas = document.getElementById('map_canvas');
        var mapOptions = {
            zoom: 4,
            center: new google.maps.LatLng(50.736455, 13.007813)
        }
        var map = new google.maps.Map(mapCanvas, mapOptions);

        var infowindow = new google.maps.InfoWindow();

        map.data.setStyle({
            icon: '{% static 'img/hackergotchi-little.png' %}'
        });

        map.data.loadGeoJson('{% url 'myplaces_api' %}');

        map.data.addListener('click', function (event) {
            var country = event.feature.getProperty('country');
            var city = event.feature.getProperty('city');
            var year = event.feature.getProperty('year');

            // Create nice infowindow
            var html = "<div style='width:150px; text-align: center; color: black;'>" + city + ", " + country + "<br>" + year + "</div>";
            infowindow.setContent(html);
            infowindow.setPosition(event.feature.getGeometry().get());
            infowindow.setOptions({pixelOffset: new google.maps.Size(0, -30)});
            infowindow.open(map);

            // Center the face
            map.setZoom(8);
            map.setCenter(event.feature.getGeometry().get());
        });
    }

    google.maps.event.addDomListener(window, 'load', initMap);
});

</script>
{% endblock %}

{% block content %}


<div class="container" id="map_canvas_container">
 <div id="map_canvas">Loading map...</div>
</div>
<hr>
<h1>{{ country_list|length }} countries visited</h1>
<div class="container">
    <div class="card-columns">
    {% for country in country_list %}

            <div class="card w-90 mb-3">
                <h5 class="card-header" style="color: black;">
                    {{ country.name }}
                </h5>
                <img class="card-img bg-dark" src="{{ country.flag }}" alt="Flag of {{ country.name }}">
                <button class="btn btn-secondary btn-sm" data-toggle="collapse" data-target="#cities{{ country.id }}"><i class="fas fa-chevron-down"></i></button>

                <div id="cities{{ country.id }}" class="collapse">
                    <ul class="list-group list-group-flush">
                        {% for city in country.cities.all %}
                            <li class="list-group-item list-group-item-action">{{ city.name }} <span class="badge badge-dark">{{ city.year|date:"Y" }}</span></li>
                        {% endfor %}
                    </ul>
                </div>
            </div>


    {% endfor %}
    </div>
</div>
{% endblock %}
